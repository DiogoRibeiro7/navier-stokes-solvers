FROM ubuntu:22.04

ENV DEBIAN_FRONTEND=noninteractive \
    TZ=Etc/UTC

RUN apt-get update && apt-get install -y --no-install-recommends \
        build-essential \
        clang \
        cmake \
        gdb \
        git \
        htop \
        lcov \
        ninja-build \
        pkg-config \
        python3 \
        python3-dev \
        python3-pip \
        python3-venv \
        wget \
        curl \
        vim \
        fftw3-dev \
        libfftw3-mpi-dev \
        && rm -rf /var/lib/apt/lists/*

RUN python3 -m pip install --upgrade pip \
    && python3 -m pip install numpy scipy matplotlib pytest jupyterlab black flake8

RUN useradd --create-home --shell /bin/bash dev
WORKDIR /workspace
RUN chown -R dev:dev /workspace
USER dev

ENV VENV_PATH=/workspace/.venv
RUN python3 -m venv ${VENV_PATH} && echo "source ${VENV_PATH}/bin/activate" >> ~/.bashrc
RUN /bin/bash -c "source ${VENV_PATH}/bin/activate && pip install numpy scipy matplotlib pytest jupyterlab"

EXPOSE 8888
EXPOSE 9000

CMD ["/bin/bash"]
